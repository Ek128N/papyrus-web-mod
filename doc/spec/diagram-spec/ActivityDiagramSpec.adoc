////
 Copyright (c) 2024 CEA LIST, Artal Technologies.
 This program and the accompanying materials
 are made available under the terms of the Eclipse Public License v2.0
 which accompanies this distribution, and is available at
 https://www.eclipse.org/legal/epl-2.0/

 SPDX-License-Identifier: EPL-2.0

 Contributors:
     Aurelien Didier (Artal Technologies) - Issue 201
////

= Activity Diagram specification
:toc:
:toclevels: 3

== Can create
Can be created under a Package, under a Model and under a BehavioredClassifier (but not inside a Profile).
__BehavioredClassifier = Actor, Collaboration, UseCase, Class, AssociationClass, Behavior,  Activity, Interaction, OpaqueBehavior, FunctionBehavior, StateMachine, ProtocolStateMachine, Component, Node, Device and ExecutionEnvironment__

== Initialization
Unless Diagram is created under an Activity, a new Activity is created and displayed as the root of the Diagram.

== Nodes

=== AcceptCallAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

To check the behavior with EEF properties View, use a Sequence Diagram, create a lifeline and a message, select the message and in its Properties, add a signature by creating an AcceptCallAction.

NOTE: Be careful to check code in org.eclipse.papyrus.uml.diagram.activity.edit.utils.updater.intermediateactions.AcceptCallActionPinUpdater

==== On Creation
AcceptCallAction should be created with an OutputPin owned by the AcceptCallAction and this output pin is referenced as the return information feature.
 Create an Outpin named "return information" in feature "AcceptCallAction#returnInformation" [1..1]
 add a packageImport if the rootPackage (or model) has not the "Primitive Types" library imported
 update Pins, (see issues [86] Handle Operation #98 [Concept] Parameter #103 for similar behavior):
 Set AcceptCallAction#isUnmarshall to true.
 Create a Trigger, set it to the AcceptEventAction#trigger feature, set a CallEvent to Trigger#event feature, init an Operation to the CallEvent#operation feature.
==== Can create
Nothing special.

==== OnSet
 When adding a trigger ("triggers" feature), update Pins.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/AcceptCallAction.png[title="Representation AcceptCallAction"]

=== AcceptEventAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
* When we add OutputPin in AcceptEventAction PS should add them to the result feature. 
* When the trigger is set 
    * if the event of the trigger is a TimeEvent then the shape should represent a hourglass. (no specific pin are created)
    * in other case the shape should represent a flag.
    * if there is multiple type of trigger event then the shape should represent a flag.
* When we remove triggers if it stay only one trigger and this trigger has a TimeEvent as event then the shape should represent a hourglass.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.

image::ActivityDiagram/AcceptEventAction.png[title="Representation AcceptEventAction"]

=== Activity
Can be created under an Activity.

==== On Creation
PS should add the Activity on BehavioredClassifier#ownedBehavior when it is add into a BehavioredClassifier.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Activity name prefixed with &laquo;activity&raquo; or &laquo;activitity, singleExecution&raquo; if is single execution if set to true. +
Label should be in italic if isAbstract is set to true.

image::ActivityDiagram/Activity.png[title="Representation Activity"]



=== ActivityFinalNode
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode and StructuredActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/ActivityFinalNode.png[title="Representation Activity Final Node"]

=== ActivityParameterNode
Can be created under an activity (as bordered node).

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
* When a parameter is drop on the activity PS should create an ActivityParameterNode

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/ActivityParameterNode.png[title="Representation ActivityParameterNode"]

=== ActivityPartition
Can be created under an Activity or under an ActivityPartition.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
The ActivityPartition label is the name of the represented element if defined, or the name of the ActivityPartition otherwise. 

image::ActivityDiagram/ActivityPartition.png[title="Representation ActivityPartition"]

=== AddStructuralFeatureValueAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
AddStructuralFeatureValueAction should be created with four pins:

* An InputPin owned by the AddStructuralFeatureValueAction and referenced as the object feature.
* An InputPin owned by the AddStructuralFeatureValueAction and referenced as the value feature.
* An InputPin owned by the AddStructuralFeatureValueAction and referenced as the insertAt feature.
* An OutputPin owned by the AddStructuralFeatureValueAction and referenced in the result feature

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
* When we drop a property on the diagram, PS should propose to create a AddStructuralFeatureValueAction

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/AddStructuralFeatureValueAction.png[title="Representation AddStructuralFeatureValueAction"]


=== ActivityNode
An ActivityNode is an abstract class which cannot be represented. See implementations like InitialNode, ActivityFinalNode, DecisionNode, AcceptEventAction, etc. which can be represented in an Activity diagram.

==== On Creation
See org.eclipse.papyrus.uml.service.types.helper.ActivityNodeHelper.getConfigureCommand(ConfigureRequest):
Following point also cover the code of org.eclipse.papyrus.uml.service.types.helper.ActivityNodeHelper.getCreateCommand(CreateElementRequest)

 If created in an Activity, add the ActivityNode the containment feature Activity#ownedNode.
 If created in an ActivityPartition, add the ActivityNode the non-containment feature ActivityPartition#node (or add the ActivityPartition to ActivityNode#inPartition). Retrieve the parent Activity of the ActivityPartition and add the ActivityNode to the containment feature Activity#ownedNode.
 If created in an InterruptibleActivityRegion, add the ActivityNode the non-containment feature InterruptibleActivityRegion#node (or add the InterruptibleActivityRegion to ActivityNode#inInterruptibleRegion). Retrieve the parent Activity of the InterruptibleActivityRegion and add the ActivityNode to the containment feature Activity#ownedNode.

==== On Move
See org.eclipse.papyrus.uml.service.types.helper.ActivityNodeHelper.getMoveOutFromPartitionCommand(MoveRequest):

 If we are moving an ActivityNode from an ActivityPartition "AP1" to another ActivityPartition "AP2", remove "AP1" from the feature ActivityNode#inPartition then add "AP2" to the feature ActivityNode#inPartition (note that the containment feature must be in an Activity: Activity#ownedNode, so I guess we should also retrieve the Activity containing the target ActivityPartition and add the ActivityNode to the Activity#ownedNode, this is not specified in the code, but it must be kept in mind).
 If we are moving an ActivityNode from an ActivityPartition "AP1" to an InterruptibleActivityRegion "IAR2", remove "AP1" from the feature ActivityNode#inPartition then add "IAR2" to the feature ActivityNode#inInterruptibleRegion (note that the containment feature must be in an Activity: Activity#ownedNode, so I guess we should also retrieve the Activity containing the target InterruptibleActivityRegion and add the ActivityNode to the Activity#ownedNode, this is not specified in the code, but it must be kept in mind).
 If we are moving an ActivityNode from an InterruptibleActivityRegion "IAR1" to another InterruptibleActivityRegion "IAR2", remove "IAR1" from the feature ActivityNode#inInterruptibleRegion then add "IAR2" to the feature ActivityNode#inInterruptibleRegion (note that the containment feature must be in an Activity: Activity#ownedNode, so I guess we should also retrieve the Activity containing the target InterruptibleActivityRegion and add the ActivityNode to the Activity#ownedNode, this is not specified in the code, but it must be kept in mind).
 If we are moving an ActivityNode from an InterruptibleActivityRegion "IAR1" to an ActivityPartition "AP2", remove "IAR1" from the feature ActivityNode#inInterruptibleRegion then add "AP2" to the feature ActivityNode#inPartition (note that the containment feature must be in an Activity: Activity#ownedNode, so I guess we should also retrieve the Activity containing the target ActivityPartition and add the ActivityNode to the Activity#ownedNode, this is not specified in the code, but it must be kept in mind).

==== Can create
Always

==== OnSet
Nothing special

==== On Deletion
 See org.eclipse.papyrus.uml.service.types.helper.ActivityNodeHelper.getBasicDestroyElementCommand(DestroyElementRequest). When an ActivityNode is removed, remove it from the containment feature Activity#ownedNode. There may be issues with other features keeping a reference to the deleted ActivityNode, so some features may need to be updated : Activity#node, ActivityPartition#node, InterruptibleActivityRegion#node.
EDIT: this part is handled by the UML service generic delete mechanism

 Incoming and Outgoing ActivityEdges need to be deleted. See org.eclipse.papyrus.uml.service.types.helper.advice.ActivityNodeHelperAdvice.getDestroyActivityEdgeCommand(DestroyDependentsRequest)

==== On Semantic DnD
Display the view

==== On Direct Edit
Edit the name

==== Label
ActivityNode is an abstract class, see implementations for the label displayed.


### AddVariableValueAction

Can be created in an Activity diagram, under an Activity, ActivityPartition, InterruptibleActivityRegion, LoopNode, SequenceNode, ConditionnalNode, ExpansionRegion and StructuredActivityNode.

#### On Creation
* PS should create an InputPin owned by the AddVariableValueAction and referenced in the insertAt feature.
* PS should create an InputPin owned by the AddVariableValueAction and referenced in the value feature.

#### Can create
Nothing special.

#### OnSet
Nothing special.

#### On Reconnect
Nothing special.

#### On Deletion
Nothing special.

#### On Semantic DnD
Nothing special.

#### On Direct Edit
Nothing special.

#### Label
Nothing special.


=== BroadcastSignalAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/BroadcastSignalAction.png[title="Representation BroadcastSignalAction"]

=== CallBehaviorAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
* In Papyrus-Desktop a pop-up appear on creation, in Papyrus-Sirius we don't want it.

==== Can create
Nothing special.

==== OnSet
* When we add InputPin in CallBehaviorAction PS should add them to the argument feature.
* When we add OutputPin in CallBehaviorAction PS should add them to the result feature. 

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
* When we drop a behavior on the diagram, PS should propose to create a CallBehaviorAction

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/CallBehaviorAction.png[title="Representation CallBehaviorAction"]

=== CallOperationAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
CallOperationAction (CAO) tool shall create the call operation action, and create an Input Pin referenced as the COA target feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/CallOperationAction.png[title="Representation CallOperationAction"]

=== ClearAssociationAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
ClearAssociationAction should be created with an InputPin owned by the ClearAssociationAction and referenced in the object feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/ClearAssociationAction.png[title="Representation ClearAssociationAction"]

=== ClearStructuralFeatureValueAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
Clear Structural Feature Action should be created with two pins:

* An InputPin owned by the Clear Structural Feature Action and referenced as the object feature.
* An OutputPin owned by the Clear Structural Feature Action and referenced in the result feature

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/ClearStructuralFeatureValueAction.png[title="Representation ClearStructuralFeatureValueAction"]

=== Comment
Can be created under an Activity, an ActivityPartition, A InterruptibleActivityRegion, an ExpansionRegion,  a ConditionalNode, a LoopNode, a SequenceNode, a StructuredActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Edit the body of the Comment.

==== Label
Nothing special.

image::Shared/Comment.png[title="Representation Comment"]

=== ConditionalNode
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Rename element but doesn't change label.

==== Label
Label should be &laquo;conditional&raquo;.
 
image::ActivityDiagram/ConditionalNode.png[title="Representation ConditionalNode"]

=== Constraint
Can be created under an Activity, an ExpansionRegion, a ConditionalNode, a LoopNode, a SequenceNode, a StructuredActivityNode.

==== On Creation
Constraint is created with a ConstraintSpecification which is an OpaqueExpression. +
By default the OpaqueExpression language is OCL and its default value is "true". +
The context feature is set to the element that was selected when creating the Constraint.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Edit only the name of the Constraint.

==== Label
Constraint label shall start by the name of the Constraint in the first line. +
And it shall display the constrainSpecification (which is an OpaqueExpression) information in a second line. +
The constraintSpecification informations shall display only the first language information as follow: {{language} body}

image::Shared/Constraint.png[title="Representation Constraint"]

=== CreateObjectAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
CreateObjectAction tool shall create the CreateObjectAction, and create an OutputPin owned by the CreateObjectAction and referenced in the result feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/CreateObjectAction.png[title="Representation CreateObjectAction"]



=== CentralBufferNode

Can be created in an Activity diagram, under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode and StructuredActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
* PS should add a sort of "comment" on the top of the node when the field selection is not empty
* PS should remove the "comment" when the field selection become empty back

==== On Move
* PS shoud move both the node and the "comment" when its existe.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
**Label of the node**
«centralBuffer»
*name of the CentralBufferNode*
*name of the type of the CentralBufferNode*

**Label of the "comment"**
«selection»
*Name of the selection*

=== ClearStructuralFeatureAction

Can be created in an Activity diagram, under an Activity, ActivityPartition, InterruptibleActivityRegion, LoopNode, SequenceNode, ConditionnalNode, ExpansionRegion and StructuredActivityNode.

==== On Creation
* PS should create an InputPin owned by the ClearStructuralFeatureAction and referenced in the object feature.
* PS should create an OutputPin owned by the ClearStructuralFeatureAction and referenced in the result feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
* When we drop a property on the diagram, PS should propose to create a ClearStructuralFeatureAction

==== On Direct Edit
Nothing special.

==== Label
Nothing special.


=== CreateLinkAction

Can be created in an Activity diagram, under an Activity, ActivityPartition, InterruptibleActivityRegion, LoopNode, SequenceNode, ConditionnalNode, ExpansionRegion and StructuredActivityNode.

==== On Creation
* PS should create an InputPin owned by the CreateLinkAction and referenced in the inputValue feature.

==== Can create
Nothing special.

==== OnSet
* When we add InputPin in CreateLinkAction PS should add them to the inputValue feature.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
* When we drop an association on the diagram, PS should propose to create a CreateLinkAction. **(precise spec for EndData should be provided)**

==== On Direct Edit
Nothing special.

==== Label
Nothing special.

=== CreateLinkObjectAction

Can be created in an Activity diagram, under an Activity, ActivityPartition, InterruptibleActivityRegion, LoopNode, SequenceNode, ConditionnalNode, ExpansionRegion and StructuredActivityNode.

==== On Creation
* PS should create an OutputPin owned by the CreateLinkObjectAction and referenced in the result feature.
* PS should create an InputPin owned by the CreateLinkObjectAction and referenced in the inputValue feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.


=== DecisionNode
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
When the DecisionNode Input field is set, Papyrus Web should add a new Note linked to the DecisionNode. +
The Note content is set to "«decisionInput»" followed by the name of the decision input.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/DecisionNode.png[title="Representation DecisionNode"]

image::ActivityDiagram/DecisionNodeWithNote.png[title="Representation DecisionNode with Note"]

=== DestroyObjectAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
DestroyObjectAction tool shall create the DestroyObjectAction, and create an InputPin owned by the DestroyObjectAction and referenced in the target feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/DestroyObjectAction.png[title="Representation DestroyObjectAction"]


=== DestroyLinkAction

Can be created in an Activity diagram, under an Activity, ActivityPartition, InterruptibleActivityRegion, LoopNode, SequenceNode, ConditionnalNode, ExpansionRegion and StructuredActivityNode.

==== On Creation
* PS should create an InputPin owned by the DestroyLinkAction and referenced in the inputValue feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
* When we drop an association on the diagram, PS should propose to create a DestroyLinkAction. **(precise spec for EndData should be provided)**

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 

=== DataStoreNode

Can be created in an Activity diagram, under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode and StructuredActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
* PS should add a sort of "comment" on the top of the node when the field selection is not empty.
* PS should remove the "comment" when the field selection become empty back.

==== On Move
* PS shoud move both the node and the "comment" when its existe.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
**Label of the node**
«datastore»
*name of the DataStoreNode*
*name of the type of the DataStoreNode*

**Label of the "comment"**
«selection»
*Name of the selection*

=== ExpansionRegion
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.
It's a container which can contains at least ActivityNode.
==== On Creation
* The ExpansionRegion should be added to the group field of the Activity.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Label can either be &laquo;iterative&raquo;, &laquo;stream&raquo; or &laquo;parallel&raquo; depending on the corresponding mode kind of the region.
 
image::ActivityDiagram/ExpansionRegion.png[title="Representation ExpansionRegion"]

=== ForkNode
Can be created in an Activity Diagram, under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, and StructuredActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== On Resize
Fork Node size is fixed.

==== Label
Nothing special.
 
image::ActivityDiagram/ForkNode.png[title="Representation ForkNode"]

=== FlowFinalNode
Can be created in an Activity Diagram, under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, and StructuredActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/FlowFinalNode.png[title="Representation FlowFinalNode"]


=== InitialNode
Can be created in an Activity Diagram, under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode and StructuredActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/InitialNode.png[title="Representation InitialNode"]

=== InputExpansionNode
Can be created under an ExpansionRegion (as bordered node).

==== On Creation
The ExpansionRegion used to create the InputExpansionNode is set as the "region as input" feature.

==== Can create
Nothing special.

==== OnSet
The view shall be synchronized with the region as input reference, i.e. removing "region as input reference" shall remove the Node from its region (graphically) and selecting a new one shall add the Node to the selected region.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/ExpansionNode.png[title="Representation InputExpansionNode"]

=== InterruptibleActivityRegion
Can be created under an Activity.It's a container which can contains at least ActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
* when the user add nodes inside the InterruptibleActivityRegion nodes are graphically added to the InterruptibleActivityRegion but semantically added to the activity owning the InterruptibleActivityRegion, however tne added node is referenced by the feature InterruptibleActivityRegion#node and the feature ActivityNode#inInterruptibleRegion of the added node is set with the InterruptibleActivityRegion.

==== On Move
* On move of a node from a InterruptibleActivityRegion, features ActivityNode#inInterruptibleRegion and InterruptibleActivityRegion#node should be update.

==== On Reconnect
* Edges can got throw the border of this compartment.

==== On Deletion
* One deletion, PS should note delete nodes inside the InterruptibleActivityRegion at least semantically.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
No label.
 
image::ActivityDiagram/InterruptibleActivityRegion.png[title="Representation InterruptibleActivityRegion"]

=== JoinNode
Can be created in an Activity Diagram, under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, and StructuredActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== On Resize
Join Node size is fixed.
* The JoinNode should keep a rectangular form with mostly the same proportion as shown in the following figure.
* On resize the JoinNode should change orientation or be extend.

==== Label
If join spec field is set, label should start with {joinSpec = *Value*}, where value can be a value or an expression. +
Join Node label is then followed by the name of the JoinNode.

image::ActivityDiagram/JoinNode.png[title="Representation JoinNode"]

=== LoopNode
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
 Should be add on Activity#structuredNode
 When the user add nodes inside a StructuredActivityNode is should be added to the StructuredActivityNode#node feature
 PS should create an OutputPin owned by the LoopNode and referenced in the decider feature. Edit: CEA think we should not initialize the decider feature. The decider feature should references a Pin of a Node in the LoopNode.

==== Can create
Nothing special.

==== OnSet
 When we add InputPin in LoopNode PS should add them to the loopNodeInput [0..-1] feature.
 When we add OutputPin in LoopNode PS should add them to the result [0..-1] feature.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Rename element but doesn't change label.

==== Label
Label should be &laquo;loop node&raquo;.
 
image::ActivityDiagram/LoopNode.png[title="Representation LoopNode"]

=== MergeNode
Can be created in an Activity Diagram, under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, and StructuredActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/MergeNode.png[title="Representation MergeNode"]

=== OpaqueAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/OpaqueAction.png[title="Representation OpaqueAction"]

=== OutputExpansionNode
Can be created under an Expansion Region (as bordered node).

==== On Creation
The Expansion region used to create the Output Expansion Node is set as the "region as output" feature.

==== Can create
Nothing special.

==== OnSet
The view shall be synchronized with the region as output reference, i.e. removing "region as output reference" shall remove the Node from its region (graphically) and selecting a new one shall add the Node to the selected region.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/ExpansionNode.png[title="Representation OutputExpansionNode"]

=== ReadExtentAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
ReadExtentAction should be created with an InputPin owned by the ReadExtentAction and referenced in the result feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/ReadExtentAction.png[title="Representation ReadExtentAction"]

=== ReadIsClassifiedObjectAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
ReadIsClassifiedObjectAction (RICAO) tool shall create the RICAO, and create 2 pins:

* An InputPin owned by the RICAO and referenced in the object feature.
* An OutputPin owned by the RICAO and referenced in the result feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/ReadIsClassifiedObjectAction.png[title="Representation ReadIsClassifiedObjectAction"]

=== ReadSelfAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
ReadSelfAction shall ben named "this" once created. +
ReadSelfAction tool shall create the ReadSelfAction, and create an OutputPin owned by the ReadSelfAction and referenced in the result feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/ReadSelfAction.png[title="Representation ReadSelfAction"]

=== ReadStructuralFeatureAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
ReadStructuralFeatureAction should be created with two pins:

* An InputPin owned by the ReadStructuralFeatureAction and referenced as the object feature.
* An OutputPin owned by the ReadStructuralFeatureAction and referenced in the result feature

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/ReadStructuralFeatureAction.png[title="Representation ReadStructuralFeatureAction"]

=== ReclassifyObjectAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
ReclassifyObjectAction shall ben named "this" once created. +
ReclassifyObjectAction tool shall create the ReclassifyObjectAction, and create an InputPin owned by the ReclassifyObjectAction and referenced in the object feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/ReclassifyObjectAction.png[title="Representation ReclassifyObjectAction"]

=== ReduceAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
ReduceAction should be created with two pins:

* An InputPin owned by the ReduceAction and referenced in the collection feature.
* An OuputPin owned by the ReduceAction and referenced in the result feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/ReduceAction.png[title="Representation ReduceAction"]


=== ReadVariableAction

Can be created in an Activity diagram, under an Activity, ActivityPartition, InterruptibleActivityRegion, LoopNode, SequenceNode, ConditionnalNode, ExpansionRegion and StructuredActivityNode.

==== On Creation
* PS should create an OutputPin owned by the ReadVariableAction and referenced in the result feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.


=== ReadLinkAction

Can be created in an Activity diagram, under an Activity, ActivityPartition, InterruptibleActivityRegion, LoopNode, SequenceNode, ConditionnalNode, ExpansionRegion and StructuredActivityNode.

==== On Creation
* PS should create an OutputPin owned by the ReadLinkAction and referenced in the result feature.
* PS should create an InputPin owned by the ReadLinkAction and referenced in the inputValue feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
* When we drop an association on the diagram, PS should propose to create a ReadLinkAction. **(precise spec for EndData should be provided)**

==== On Direct Edit
Nothing special.

==== Label
Nothing special.



=== SequenceNode
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
 Should be add on Activity#structuredNode
 When the user add nodes inside a StructuredActivityNode is should be added to the StructuredActivityNode#node feature. The user can only add ExecutableNode to the SequenceNode#executableNode feature (which redefines StructuredActivityNode#node feature)

==== Can create
Nothing special.

==== OnSet
 When we add OutputPin in SequenceNode PS should add them to the structuredNodeOutput feature.
 When we add InputPin in SequenceNode PS should add them to the structuredNodeInput feature.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Rename element but doesn't change label.

==== Label
Label should be &laquo;sequence&raquo;.
 
image::ActivityDiagram/SequenceNode.png[title="Representation SequenceNode"]

=== SendObjectAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
SendObjectAction tool shall create the call operation action, and create two pins:

* An InputPin owned by the Send Object Action and referenced in the request feature.
* An OutputPin owned by the Send Object Action and referenced in the target feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/SendObjectAction.png[title="Representation SendObjectAction"]

=== SendSignalAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
SendSignalAction tool shall create the Signal Action, and create an InputPin owned by the SendSignalAction and referenced in the target feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/SendSignalAction.png[title="Representation SendSignalAction"]

=== StartClassifierBehaviorAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
StartClassifierBehaviorAction tool shall create the StartClassifierBehaviorAction, and create an InputPin owned by the StartClassifierBehaviorAction and referenced in the object feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/StartClassifierBehaviorAction.png[title="Representation StartClassifierBehaviorAction"]

=== StartObjectBehaviorAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
StartObjectBehaviorAction tool shall create the StartObjectBehaviorAction, and create an InputPin owned by the StartObjectBehaviorAction and referenced in the object feature.

==== Can create
Nothing special.

==== OnSet
* When we add InputPin in StartObjectBehaviorAction PS should add them to the argument feature.
* When we add OutputPin in StartObjectBehaviorAction PS should add them to the result feature.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/StartObjectBehaviorAction.png[title="Representation StartObjectBehaviorAction"]

=== StructuredActivityNode
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

* When the user add nodes inside a StructuredActivityNode is should be added to the StructuredActivityNode#node feature
Same Rules than other actions:

==== On Creation
 Should be add on Activity#structuredNode
 When the user add nodes inside a StructuredActivityNode is should be added to the StructuredActivityNode#node feature

==== Can create
Nothing special.

==== OnSet
 When we add OutputPin in StructuredActivityNode PS should add them to the structuredNodeOutput feature.
 When we add InputPin in StructuredActivityNode PS should add them to the structuredNodeInput feature.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Rename element but does not change label.

==== Label
Label should be &laquo;sequence&raquo;.
 
image::ActivityDiagram/StructuredActivityNode.png[title="Representation StructuredActivityNode"]

=== TestIdentityAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
Test Identity Action should be created with three pins:

* An InputPin owned by the TestIdentityAction and referenced in the first feature.
* An InputPin owned by the TestIdentityAction and referenced in the second feature.
* An OutputPin owned by the TestIdentityAction and referenced in the result feature

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/TestIdentityAction.png[title="Representation TestIdentityAction"]

=== ValueSpecificationAction
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation
ValueSpecificationAction tool shall create the ValueSpecificationAction, and create an OutputPin owned by the ValueSpecificationAction and referenced in the result feature.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.
 
image::ActivityDiagram/ValueSpecificationAction.png[title="Representation ValueSpecificationAction"]



=== UnmarshallAction

Can be created in an Activity diagram, under an Activity, ActivityPartition, InterruptibleActivityRegion , LoopNode, SequenceNode , ConditionnalNode, ExpansionRegion and StructuredActivityNode.

==== On Creation
* PS should create an InputPin owned by the UnmarshallAction and referenced in the object feature.

==== Can create
Nothing special.

==== OnSet
* When we add OutputPin in UnmarshallAction PS should add them to the result feature. 

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
* When we drop a Classifier on the diagram, PS should propose to create a UnmarshallAction.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.


== Pins

* Pins should always be displayed (they cannot be hidden) (Synchronised mapping).
* Pins created during the creation of a node, should be named using the feature (referencing them) name.
* By default, input pins and output pins shall be created on the right of the node containing them.

===  ActionInputPin, InputPin and ValuePin

==== On creation
Create the pin and reference it using the appropriate reference (see Can Create list).

==== Can create
The list below describe the all the kind of nodes that should allow Input Pin creation (and also the name of the reference used to refer to the pin):

* AddStructuralFeatureValueAction as object
* AddStructuralFeatureValueAction as insertAt
* AddStructuralFeatureValueAction as value
* AddVariableValueAction as insertAt
* AddVariableValueAction as value
* BroadcastSignalAction as argument
* CallBehaviorAction as argument
* CallOperationAction as target
* CallOperationAction as argument
* ClearAssociationAction as object
* ClearStructuralFeatureAction as value
* ConditionalNode as structuredNodeInput
* CreateLinkAction as inputValue
* CreateLinkObject action as inputValue
* DestroyLinkAction as inputValue
* DestroyObjectAction as target
* ExpansionRegion as structuredNodeInput
* LoopNode as loopVariableInput
* OpaqueAction as inputValue
* ReadIsClassifiedObjectAction as object
* ReadLinkAction as inputValue
* ReadStructuralFeatureAction as object
* ReclassifyObjectAction as object
* ReduceAction as collection
* SendObjectAction as target
* SendObjectAction as request
* SendSignalAction as target
* SendSignalAction as argument
* SequenceNode as structuredNodeInput
* StartClassifierBehaviorAction as object
* StartObjectBehaviorAction as object
* StartObjectBehaviorAction as argument
* StrucuredActivityNode as structuredNodeOutput
* TestIdentityAction as first
* TestIdentityAction as second
* UnmarshallAction as object

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
InputPin deletion should also delete outgoing edges.

==== On Semantic DnD
Not available, pins shall always be displayed when they exist (sycnhronized).

==== On Direct edit
Not available on pins.

==== Label
Nothing special.

==== Graphical Representation
Input Pin inner arrow should always be displayed coming from outside the node to inside it. +
Input Pin that have outgoing relation shall be displayed without arrow inside.

image::ActivityDiagram/InputPin.png[title="Representation InputPin"]

=== OutputPin

==== Can create
The list below describe the all the kind of nodes that should allow Output Pin creation (and also the name of the reference used to refer to the pin):

* AcceptEventAction as result
* AddStructuralFeatureValueAction as result
* AcceptEventAction as result
* CallBehaviorAction as result
* CallOperationAction as result
* ClearStructuralFeatureAction as result
* CreateLinkObjectAction as result
* CreateObjectAction as result
* ConditionalNode as structuredNodeOutput
* ConditionalNode as result
* ExpansionRegion as structuredNodeOutput
* LoopNode as bodyOutput
* LoopNode as decider
* LoopNode as loopVariable
* LoopNode as result
* OpaqueAction as outputValue
* ReadExtentAction as result
* ReadIsClassifiedObjectAction as result
* ReadLinkAction as result
* ReduceAction as result
* ReadStructuralFeatureAction as result
* SequenceNode as structuredNodeOutput
* StartObjectBehaviorAction as result
* StrucuredActivityNode as structuredNodeOutput
* ReadSelfAction as result
* ValueSpecificationAction as result
* TestIdentityAction as result
* UnmarshallAction as result

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
InputPin deletion should also delete outgoing edges.

==== On Semantic DnD
Not available, pins shall always be displayed when they exist (sycnhronized).

==== On Direct edit
Not available on pins.

==== Label
Nothing special.

==== Graphical Representation
Output Pin inner arrow should always be displayed coming from inside the node to outside it. +
OuputPin that have incoming relation shall be displayed without arrow inside.

image::ActivityDiagram/OutputPin.png[title="Representation OutputPin"]

==== ValuePin

Same as InputPin and ActionInputPin but a new label is added when the value is set.


== Edges

=== AnyReceiveEvent  

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Display the view

==== On Direct Edit
TODO

==== Label
Nothing special.

=== ControlFlow
Can be created in an Activity Diagram, under an Activity, ActivityPartition, InterruptibleActivityRegion, LoopNode, SequenceNode, ConditionnalNode, ExpansionRegion and StructuredActivityNode.

==== On Creation
* Control Flow shall be created without name.
* Selected source shall set its outgoing reference to the created Object Flow.
* Selected target shall set its incoming reference to the created Object Flow.

==== Can create
Source and Target shall be Nodes or Pins. +
Source shall not be a Flow Final Node or Activity Final Node. +
Target shall not be an Initial Node. +
Pins and Activity Parameter Nodes shall be available as source and target only if their control type is set to True. +
(__Output Pins can be used as source and target and same for InputPin__)

==== OnSet
Nothing special.

==== On Reconnect
Control Flow reconnection should update incoming and outgoing field of old and new source and target. +
Control Flow reconnection should update inPartition feature of the edge if new source or target are outside partition.

==== On Deletion
Control Flow deletion should remove deprecated incoming and outgoing field of old and current source and target.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
* PS should allow the Direct Edit on simple expression for weight and guard as well of the name of the ControlFlow (at least for OpaqueExpression and Literals).

==== Label
Control Flow label shall be defined the following way: +
1. Start with the name of the ControlFlow (no name by default). +
2. if weight is defined, add content of the weight, with the following format: {weight=*content of the weight*} +
3. If guard is defined, end with the content (not the name) of the guard field between []

image::ActivityDiagram/ControlFlow.png[title="Representation ControlFlow"]


=== ExceptionHandler

Can be created in an Activity diagram, under an ExecutableNode.

==== On Creation
* PS should add the ExceptionHandler under the source
* PS should set the exceptionInput field with the target ObjectNode
* PS should set the handlerBody field with the target ObjectNode owner
* PS should set the protectedNode field with the source

==== Can create
* PS should allow the creation of ExceptionHandler between an ExecutableNode as source and a ObjectNode as target

==== OnSet
Nothing special.

==== On Reconnect
* PS should change the location of the link when the source is reconnect
* Ps should update the ExceptionHandler#exceptionInput feature on reconnect

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.

=== ExtensionEnd 

==== On Creation
 Aggregation is initialized with Composite value

==== Can create
Nothing special.

==== OnSet
 Type must be a stereotype. See org.eclipse.uml2.uml.internal.impl.ExtensionEndImpl.setType(Type):
	@Override
	public void setType(Type newType) {
		if (newType != null && !(newType instanceof Stereotype)) {
			throw new IllegalArgumentException(
				"newType must be an instance of Stereotype"); //$NON-NLS-1$
		}
		...
	}
 multiplicity should be 1 or 0..1

==== On Deletion
Nothing special.

==== On Semantic DnD
Display the view

==== On Direct Edit
TODO

==== Label
Same as Property #73

 if feature "isStatic" is true, label is underline
 label should display visibility, is derived, name, type, multiplicity and default value.


=== Extension 

==== On Creation
 The new Extension is added into the PackagedElement feature of the container.

 The Extension contains an ExtensionEnd

 The ExtensionEnd is typed by the source (the stereotype)

 The ExtensionEnd Aggregation feature value is AggregationKind.COMPOSITE_LITERAL

 A new Property is created:

name: ExtensionHelper.BASE + target.getName());

type: the target (the class)

association: The new created Extension

ggregation: AggregationKind.NONE_LITERAL

Lower: 0

newExtension.getMemberEnds().add(property);

source.getOwnedAttributes().add(property);

==== Can Create
 The source is a Stereotype
 The target is a Class

==== Container
 The first source ( the stereotype) parent container of type Package

==== Can Reconnect
TODO

==== Delete tool
TODO

==== DnD tools
TODO

==== Direct edit tool
TODO

==== Label
TODO


=== Link (from Comment)
Can be created under an Activity, an ActivityPartition, A InterruptibleActivityRegion, an ExpansionRegion,  a ConditionalNode, a LoopNode, a SequenceNode, a StructuredActivityNode. +
Link is a feature based edge (it does not represent a semantic element).

==== On Creation
No element is created. Tool add the targeted element as an annotatedElement of the Comment.

==== Can create
Source shall be a Comment. +
Target can be anything.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Not available. Nothing to edit.

==== Label
No label.

image::ActivityDiagram/Link_Comment.png[title="Representation Link (from Comment)"]

=== Link (from Constraint)
Can be created under an Activity, an ExpansionRegion, a ConditionalNode, a LoopNode, a SequenceNode, a StructuredActivityNode. +
Link is a feature based edge (it does not represent a semantic element). +

==== On Creation
No element is created. Tool add the targeted element as an constrainedElement of the Constraint.

==== Can create
Source shall be a Constraint. +
Target can be anything.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Not available. Nothing to edit.

==== Label
No label.

image::ActivityDiagram/Link_Constraint.png[title="Representation Link (from Constraint)"]

=== ObjectFlow
Can be created under an Activity, ActivityPartition, ConditionnalNode, ExpansionRegion, InterruptibleActivityRegion, LoopNode, SequenceNode and StructuredActivityNode.

==== On Creation

* Object Flow shall be created without name.
* Selected source shall set its outgoing reference to the created Object Flow.
* Selected target shall set its incoming reference to the created Object Flow.

==== Can create

Source rules: +

* Opaque Actions shall be the only kind of action that are directly available as source.
* InputPin, Initial Node and Final Node shall not be available as target.
* JoinNode and MergeNode shall be available as source only if they don't already have outgoing edge.
* ForkNode shall be available as source only
* Merge Node shall be available only if there is no outgoing link and if not already connected to a Control Flow.
* DecisionNode Node shall be available only if not already connected to a Control Flow.
* ActivityParameterNode shall be available as source only is they already have incoming edge.
* OutputExpansionNode shall be available as target.

Target rules: +

* Opaque Actions shall be the only kind of action that are directly available as target.
* OutputPin shall not be available as target.
* ActivityParameterNode shall be available as target only is they already have outgoing edge.
* DecisionNode shall be available as target if they have less than two incoming edge. 
* ForkNode shall be available as target if they have no incoming edge and no incoming or outgoing control flow.
* InitialNode shall not be available as target.
* JoinNode shall be available as target unless they have an outgoing control flow.
* MergeNode shall be available as target if they have no control flow.
* InputExpansionNode shall be available as source.

==== OnSet
Nothing special.

==== On Reconnect
Object Flow shall be update incoming and outgoing field of old and current source and target.

==== On Deletion
Object Flow shall delete incoming and outgoing field of old and current source and target.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Object Flow label shall be defined the following way: +
1. Start with the name of the ControlFlow (no name by default). +
2. if weight is defined, add content of the weight, with the following format: {weight=*content of the weight*} +
3. If guard is defined, end with the content (not the name) of the guard field between [] 

image::ActivityDiagram/ObjectFlow.png[title="Representation ObjectFlow"]