////
 Copyright (c) 2024 CEA LIST, Artal Technologies.
 This program and the accompanying materials
 are made available under the terms of the Eclipse Public License v2.0
 which accompanies this distribution, and is available at
 https://www.eclipse.org/legal/epl-2.0/

 SPDX-License-Identifier: EPL-2.0

 Contributors:
     Aurelien Didier (Artal Technologies) - Issue 201
////

= State Machine Diagram specification
:toc:
:toclevels: 3 

== Can create 
Can be created under a StateMachine.

== Initialization
Display the StateMachine as the root of the Diagram (labeled with a &laquo;stateMachine&raquo; prefix). 

image::StateMachineDiagram/StateMachineDiagram.png[title="Representation State Machine Diagram"]

== Nodes

=== Choice
Can be created in a Region.

==== On Creation
Create a PseudoState with it feature kind initialized to choice.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.

image::StateMachineDiagram/Choice.png[title="Representation Choice"]

=== Comment
Can be created in a State Machine Diagram and under a Region.

==== On Creation
Nothing special.

==== Can create
Always

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Display the view

==== On Direct Edit
Edit the body of the Comment.

==== Label
The body

image::Shared/Comment.png[title="Representation Comment"]
In Papyrus the comments can be created on regions (In state machine and in states)

=== DeepHistory
Can be created in a Region.

==== On Creation
Create a PseudoState with it feature kind initialized to deepHistory.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.

image::StateMachineDiagram/DeepHistory.png[title="Representation DeepHistory"]

=== EntryPoint
Can be created in StateMachine or under a State(as bordered node).

==== On Creation
Create a PseudoState with it feature kind initialized to entryPoint.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.

image::StateMachineDiagram/EntryPoint.png[title="Representation EntryPoint"]

=== ExitPoint
Can be created in StateMachine or under a State (as bordered node).

==== On Creation
Create a PseudoState with it feature kind initialized to exitPoint.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.

image::StateMachineDiagram/ExitPoint.png[title="Representation ExitPoint"]

=== FinalState
Can be created in a Region.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
It deletes all ingoing and outgoing Transitions

==== On Semantic DnD
The drop tool will create the view

==== On Direct Edit
Nothing special.

==== Label
The name is displayed

image::StateMachineDiagram/FinalState.png[title="Representation FinalState"]

=== Fork
Can be created in a Region.

==== On Creation
Create a PseudoState with it feature kind initialized to fork.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.

image::StateMachineDiagram/Fork.png[title="Representation Fork"]

=== Initial
Can be created in a Region.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.

image::StateMachineDiagram/Initial.png[title="Representation Initial"]

=== Join
Can be created in a Region.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.

image::StateMachineDiagram/Join.png[title="Representation Join"]

=== Junction
Can be created in a Region.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.

image::StateMachineDiagram/Junction.png[title="Representation Junction"]


=== PseudoState

==== On Creation
The Pseudostate kind is initialized with the correct value
==== Can Create

Nothing special

==== On Deletion
It deletes all ingoing and outgoing Transitions

==== On Set
Nothing special

==== On Semantic DnD
The drop tool will create the view

==== On Graphic DnD
NA

==== On Direct Edit

==== Label
The label is initialized with "New <max numbre+1>"
The name is displayed


=== Region
Can be created in StateMachine or under a State.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Shall not be deletable if there is only one Region. Also delete all elements contained in the Region.

==== On Semantic DnD
Nothing is done because the node is synchronized

==== On Direct Edit
Nothing special.

==== Label
No label.

image::StateMachineDiagram/1Region.png[title="Representation One Region"]

image::StateMachineDiagram/2Region.png[title="Representation Two Region"]

=== ShallowHistory
Can be created in a Region.

==== On Creation
Create a PseudoState with it feature kind initialized to shallowHistory.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.

image::StateMachineDiagram/ShallowHistory.png[title="Representation ShallowHistory"]

=== State
Can be created in a Region.

==== On Creation
Nothing special.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
It deletes all ingoing and outgoing Transitions

==== On Semantic DnD
The drop tool will create the view

==== On Direct Edit
Nothing special.

==== Label
Nothing special.

image::StateMachineDiagram/State.png[title="Representation State"]

=== StateMachine

==== NodeDescription
State in Papyrus legacy
In Papyrus legacy, there is two cases to represent StateMachine in a StateMachine diagram.

The StateMachine diagram is created under a Package
In this case, many StateMachine can be dropped in this diagram
The StateMachine diagram is created under a StateMachine
inconsistency 1: Many StateMachine can be dropped in this diagram which is not logical
inconsistency 2: Only the StateMachine associated to the diagram is correctly managed: the other StateMachine dropped in this diagram can not be edited (it is then not possible to add region or drop region)
inconsistency 3: We can remove from diagram the StateMachine which is not logical

==== Proposal
In Papyrus web, we propose to manage the case 2 : associate the StateMachine diagram to a StateMachine
The StateMachine will be the only root node in this diagram
The StateMachine node is synchronized so that it is always displayed as root element. So the drop of StateMachine is not necessary.

==== On Creation
The StateMachine can not be created with a tool because the diagram is associated with the StateMachine
The only way to create a StateMachine is to create it from the explorer
(out of scope) Enhancement: The Region could be created at the same time the StateMachine is created. Core developement needed.

==== Can Create
Nothing special

==== On Deletion
It is not possible to delete the StateMachine from the StateMachine diagram because the diagram represents the StateMachine itself.
A delete tool has been added that does NOTHING.
(out of scope) Enhancement: It should be possible to specify that no delete tool is available on the StateMachine node.

==== On Set
Nothing special

==== On Semantic DnD
Nothing because the node is synchronized.

==== On Graphic DnD
Not implemented

==== On Direct Edit
Nothing special

==== Label
Displays the feature name
 The label should be displayed in italic if the element is abstract

=== Terminate
Can be created in a Region.

==== On Creation
Create a PseudoState with it feature kind initialized to terminate.

==== Can create
Nothing special.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Nothing special.

==== Label
Nothing special.

image::StateMachineDiagram/Terminate.png[title="Representation Terminate"]

== Edges

=== Link (from Comment)
Can be created in a State Machine Diagram or under a Region. +
Link is a feature based edge (it does not represent a semantic element).

==== On Creation
No element is created. Tool add the targeted element as an annotatedElement of the Comment.

==== Can create
Source shall be a Comment. +
Target can be anything.

==== OnSet
Nothing special.

==== On Reconnect
Nothing special.

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing special.

==== On Direct Edit
Not available. Nothing to edit.

==== Label
No label.

image::StateMachineDiagram/Link_Comment.png[title="Representation Link (from Comment)"]

=== Transition
Can be created in a Region.
source and target Vertex are set

==== On Creation
Nothing special.

==== Can create
Source and Target must be State, a Final State or a PseudoState (Choice, DeepHistory, Fork, Initial, Join, Junction, Shallow History Terminate) or EntryPoint/ExitPoint.

==== OnSet
Nothing special.

==== On Reconnect
It is possible to reconnect the source or the target of the Transition

==== On Deletion
Nothing special.

==== On Semantic DnD
Nothing because the edge is synchronized

==== On Direct Edit
Theere is no direct edit on Transition (required XText editor)

==== Label
Transition labels shall be composed the following way: +
Start with triggers labels separated with comma. Trigger label is the event name or "all" if no event is defined. +
If a guard is defined, add its label between [ ]. Guard label is either a Constraint specification expression if selection is a constraint or and Interaction constraint, or a time expression [1..5] if its a Duration, Interval or TimeConstraint. +
If an effect is defined, add "/" followed byt the effect label. Effect label starts with its kind (Activity, FunctionBehavior, Interaction, OpageBehavior, ProtocolStateMachine or StateMachine) and followed by the referenced element name.

image::StateMachineDiagram/Transition.png[title="Representation Transition"]
